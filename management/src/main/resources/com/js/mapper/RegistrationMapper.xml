<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.js.mapper.RegistrationMapper">
    <!--    插入报名信息-->
    <insert id="insert">
        insert into registration(user_id, activity_id)
        values (#{userId}, #{activityId})
    </insert>
    <!--    删除报名信息-->
    <delete id="deleteByActivityId">
        delete from registration where user_id = #{userId} and activity_id = #{activityId}
    </delete>

    <!--    查询用户是否已经报名-->
    <select id="getByUserIdAndActivityId" resultType="java.lang.Integer">
        select 1
        from registration
        where user_id = #{userId}
          and activity_id = #{activityId} limit 1
    </select>

    <!--    查询报名信息 -->
    <select id="getById" resultType="com.js.pojo.Registration">
        select r.*,
               a.name,
               a.type_id,
               a.start_time,
               a.end_time,
               a.location,
               a.max_people,
               a.current_people,
               a.description,
               a.status,
               a.creator_id,
               a.create_time,
               at.name as typeName,
               u.name  as creatorName
        from registration r
                 left join activity a on r.activity_id = a.id
                 left join activity_type at
        on a.type_id = at.id
            right join user u on a.creator_id = u.id
        where r.user_id = #{id}
    </select>

</mapper>